name: demo
root: <%= ENV["PWD"] %>

# Runs on project start, always
on_project_start: brew services start zookeeper; brew services start kafka

windows:
  - run:
      layout: tiled
      panes:
        - cd statusconsumer; python3 app.py
        - cd images-from-postapi; source .envrc; go run src/images-from-postapi/main.go
        - cd objectdetector; python3 app.py
        - cd imagewatcher-go; source .envrc; cd src/imagewatcher; IMAGE_TOPIC=opencv-kafka-demo-raw-images PORT=8080 go run main.go
        - cd imagewatcher-go; source .envrc; cd src/imagewatcher; IMAGE_TOPIC=opencv-kafka-demo-objectdetector-images PORT=8081 go run main.go
        - sleep 5; cd imagesfromopencv-to-postapi; POST_ENDPOINT=http://localhost:8000/image CAMERA=opencv python3 app.py
